const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./Search-1.2.3.js","./entry-1.2.3.js","./entry-1.2.3.css","./Search-1.2.3.css"])))=>i.map(i=>d[i]);
import{_ as j,D as G,m as Q,r as M,u as J,a as K,at as X,dw as Y,dx as Z,dy as ee,dz as se,E as te,w as ae,aN as P,c as n,o,f as a,h as L,i as l,H as g,G as re,a4 as S,z as R,j as w,y as z,d as ne,C as oe,dA as le,dB as ie,F as ce}from"./entry-1.2.3.js";const de=oe(()=>ce(()=>import("./Search-1.2.3.js"),__vite__mapDeps([0,1,2,3]),import.meta.url).then(b=>b.default||b)),ue={class:"ai-box wrap"},pe={class:"ai-text skeleton-list"},he={class:"user-box wrap"},ge={class:"user-wrap"},fe={class:"user-text"},ve=["innerHTML"],_e=["onClick"],ke={key:0,class:"unlock",src:"https://static.ppkao.com/chat/assets/lock.png"},me={key:1,class:"login-btn"},ye={key:1},we={class:"ai-text"},be={key:0,class:"ball-pulse"},xe={key:0},qe=["innerHTML"],Ce=["onClick"],Me={key:2,class:"keep-ask"},Le={class:"title-list"},Se=["title","onClick"],Te={class:"search-box"},Be=30,$e={__name:"Box",emits:["sendRecord"],setup(b,{emit:H}){const v=G(),e=Q([]),_=M(null),I=M(null),p=M(!1),k=J(),N=K(),V=H;X(()=>{f()}),Y((r,s,i)=>{s.query.q!==r.query.q&&(f(r.query.q),i()),s.query.date!==r.query.date&&(f(r.query.q,!1,r.query.date),i())});const T=()=>{f(),k.setModal("pay",!1),k.setModal("scan",!1)},D=r=>{var s,i;if(r){if((s=window==null?void 0:window.marked)!=null&&s.marked){const t=le(r),c=(i=window==null?void 0:window.marked)==null?void 0:i.marked(t);return ie(c)}return r}},B=()=>{P(()=>{_.value&&(_.value.scrollTop=_.value.scrollHeight)})},F=r=>{r.noPermission?k.setModal("pay",!0,T):k.setModal("scan",!0,T)},f=async(r=v.query.word||v.query.q,s,i=v.query.date)=>{var h;if((i||e.length===0)&&(p.value=!0),s&&e.pop(),((h=v.query)==null?void 0:h.model)==="ai"&&(s=!0),N.userInfo.isLogin){e.splice(0,e.length,{needLogin:!0,word:r}),p.value=!1;return}const{List:t,DayList:c}=await Z({date:i,pagesize:100});if(c.length>0&&V("sendRecord",c),t.length>0){const u=t.map(m=>{const{title:x,content:q,ID:C,stfrom:y}=m;return{word:x,answer:q.replace(/\n\r|\r\n/g,"<br>").replace(/(<br\s*\/?>){2,}/g,"<br>"),id:C,isRecord:!0,stfrom:y}});u.reverse(),e.splice(0,e.length,...u)}if(!r){p.value=!1;return}e.push({word:r,loading:!0});try{const{UserQueryList:u,S:m,msg:x}=s?await ee({word:r}):await se({word:r,take:5});if(m==="1"){const[{title:q,content:C,table:y,id:$,stfrom:O}]=u;e.length>1&&$===e[e.length-2].id&&e.pop();const W=parseFloat(u[0].score),E=new Set,A=u.filter(d=>Math.abs(W-parseFloat(d.score))<=Be).filter(d=>E.has(d.title)?!1:(E.add(d.title),!0)).map(d=>({title:d.title,answer:d.content.replace(/\n\r|\r\n/g,"<br>").replace(/(<br\s*\/?>){2,}/g,"<br>"),id:d.id,stfrom:d.stfrom,table:y}));e[e.length-1]={title:q,word:r,answer:C.replace(/\n\r|\r\n/g,"<br>").replace(/(<br\s*\/?>){2,}/g,"<br>"),isAi:y==="ks_kstkai",id:$,loading:!1,stfrom:O},A.length>1&&(e[e.length-1].list=A)}else m==="-4"?e[e.length-1]={word:r,noPermission:!0,loading:!1}:e[e.length-1]={word:r,answer:x,loading:!1,isAi:!0};p.value=!1}catch(u){te.error(`${u.message}， 请刷新后重试`),p.value=!1}},U=r=>{const{title:s,answer:i,table:t,id:c,stfrom:h}=r;e.push({word:s,answer:i.replace(/\n\r|\r\n/g,"<br>").replace(/(<br\s*\/?>){2,}/g,"<br>"),isAi:t==="ks_kstkai",id:c,loading:!1,stfrom:h})};return ae(e,()=>{B&&B(),P(()=>{window.renderMathInElement&&document.querySelectorAll(".rich-text").forEach(s=>{window.renderMathInElement(s,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1},{left:"\\[",right:"\\]",display:!0},{left:"\\(",right:"\\)",display:!1}],throwOnError:!1})})})},{depp:!0,immediate:!0}),(r,s)=>{const i=de;return o(),n("div",{ref_key:"chatBox",ref:_,class:"main wrap-main"},[a("div",{ref_key:"chatWrap",ref:I,class:"box wrap-box"},[l(p)?(o(),n(g,{key:0},[s[1]||(s[1]=re('<div class="user-box wrap" data-v-25266d58><div class="user-wrap" data-v-25266d58><div class="user-text user-skeleton-list" data-v-25266d58><div class="skeleton user-skeleton" style="margin-bottom:0;" data-v-25266d58></div></div><img class="avatar" src="https://static.ppkao.com/assets/image/avatar.png" data-v-25266d58></div></div>',1)),a("div",ue,[s[0]||(s[0]=a("img",{class:"avatar",src:"https://static.ppkao.com/chat/assets/bot.png"},null,-1)),a("div",pe,[(o(),n(g,null,S([1,2,3,4],t=>a("div",{key:t,class:"skeleton"})),64))])])],64)):(o(!0),n(g,{key:1},S(l(e),(t,c)=>(o(),n(g,{key:t.id},[a("div",he,[a("div",ge,[a("div",fe,[a("span",{class:"text",innerHTML:t.word},null,8,ve)]),s[2]||(s[2]=a("img",{class:"avatar",src:"https://static.ppkao.com/assets/image/avatar.png"},null,-1))])]),a("div",{class:R(["ai-box wrap",{"is-last":l(e).length-1===c}])},[s[5]||(s[5]=a("img",{class:"avatar",src:"https://static.ppkao.com/chat/assets/bot.png"},null,-1)),t.needLogin||t.noPermission?(o(),n("div",{key:0,class:R(["login-box",{"lock-box":t.noPermission}]),onClick:h=>F(t)},[s[3]||(s[3]=a("div",{class:"text"},[w("暂无权限暂无权限暂无权限"),a("br"),w("暂无权限暂无权限暂无权限暂无权限试"),a("br"),w("文字暂无权限字暂无权限"),a("br"),w(" 暂无权限字暂无权限 ")],-1)),t.noPermission?(o(),n("img",ke)):(o(),n("button",me,"免费查看"))],10,_e)):(o(),n("div",ye,[a("div",we,[t.loading?(o(),n("div",be,s[4]||(s[4]=[a("div",null,null,-1),a("div",null,null,-1),a("div",null,null,-1),a("div",null,null,-1)]))):(o(),n(g,{key:1},[t.title?(o(),n("h4",xe,z(t.title),1)):L("",!0),a("span",{class:"rich-text text",innerHTML:D(t.answer)},null,8,qe)],64))]),l(e).length-1===c&&l(e)[l(e).length-1].answer&&!l(e)[l(e).length-1].isAi?(o(),n("span",{key:0,class:"refresh-text",onClick:h=>f(t.word,!0)},"这不是我想要的答案？",8,Ce)):L("",!0)]))],2)],64))),128)),l(e)[l(e).length-1]&&l(e)[l(e).length-1].list?(o(),n("div",Me,[s[6]||(s[6]=a("span",null,"继续问：",-1)),a("div",Le,[(o(!0),n(g,null,S(l(e)[l(e).length-1].list,t=>(o(),n("div",{title:t.title,onClick:c=>U(t)},z(t.title),9,Se))),256))])])):L("",!0)],512),a("div",Te,[ne(i,{height:"160px"})])],512)}}},Ae=j($e,[["__scopeId","data-v-25266d58"]]);export{Ae as default};
