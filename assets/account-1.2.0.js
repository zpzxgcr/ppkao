import{_ as L,a as j,a3 as H,k as W,m as h,r as Q,at as X,au as G,c as k,o as v,f as s,d as c,i as e,y as u,G as z,B as U,e as r,j as p,a6 as Z,A as f,ap as T,aL as C,s as S,aO as V,aP as I,aQ as J,E as B}from"./entry-1.2.0.js";import{E as K}from"./el-image-viewer-1.2.0.js";import{E as Y}from"./el-scrollbar-1.2.0.js";import{E as tt}from"./el-checkbox-1.2.0.js";import{E as st}from"./el-dialog-1.2.0.js";import{g as et,w as ot,s as lt,u as at,b as it,l as nt}from"./user-1.2.02.js";import"./index-1.2.05.js";import"./isEqual-1.2.0.js";import"./_Uint8Array-1.2.0.js";const rt={class:"user__info"},dt={class:"user__box"},pt=["src"],mt={class:"user"},ct={class:"nickname"},ut={class:"id"},ft={class:"other__box"},_t={class:"item__box"},wt={key:0,class:"phoneNumber"},gt={class:"item__box"},vt={class:"item__box"},xt={class:"item__box"},yt={key:0,class:"dialog__body"},bt={class:"item__form",style:{"margin-top":"36px"}},kt={class:"content"},Tt={class:"phone__num"},ht={class:"item__form",style:{"margin-top":"16px"}},Dt={class:"content"},Pt={class:"item__form"},Ct={class:"content"},Mt={class:"item__form"},zt={class:"content"},Ut={key:1,class:"dialog__body"},Vt={class:"item__form",style:{"margin-top":"20px"}},It={class:"content"},$t={class:"item__form"},Et={class:"content"},St={key:2,class:"dialog__body"},Bt={class:"qrcode__box"},Nt={key:3,class:"dialog__body"},At=["innerHTML"],Ft={class:"item__form",style:{"margin-top":"20px"}},qt={class:"content",style:{margin:"0","max-width":"100%"}},Ot={__name:"account",setup(Rt){const M=j(),$=H(),m=W(()=>M.userInfo),_=h({md5:"",mobilePhone:"",yzm:""}),n=h({show:!0,count:0,timer:null}),x=h({md5:"",yzm:"",confirmNewPwd:"",newPwd:""}),y=h({pwd:"",checked:!1}),d=Q(!1),o=h({protocolData:"",qrcode:"",type:1,openTitle:"修改密码",showDialog:!1,errorTxt:"请设置包含字母与数字的6-16位密码"}),D=()=>{d.value=!1,Object.assign(_,{md5:"",mobilePhone:"",yzm:""}),Object.assign(x,{md5:"",yzm:"",confirmNewPwd:"",newPwd:""}),Object.assign(y,{pwd:"",checked:!1}),o.showDialog=!1,o.errorTxt=""},N=()=>{n.count=60,n.show=!1,n.timer=S(()=>{n.count>0?n.count--:(clearInterval(n.timer),n.show=!0,n.timer=null)},1e3)},E=async()=>{if(n.show){d.value=!0,o.errorTxt="";let a=_.mobilePhone;if(o.type===1&&(a=m.value.Mobile),!/^1[3456789]\d{9}$/.test(a)){o.errorTxt="请输入正确的手机号";return}const t=await lt({Mobile:a,flag:13,MD5:J(a+"ppkao.com")});_.md5=t.MD5Code,t.S==="1"?N():o.errorTxt=t.msg,d.value=!1}},A=async()=>{const{mobilePhone:a,yzm:t,md5:i}=_;if(o.errorTxt="",!a||!/^1[3456789]\d{9}$/.test(a)){o.errorTxt="请输入正确的手机号";return}if(!t||!i){o.errorTxt="请输入有效的验证码";return}d.value=!0;const w=await it({phone:a,code:t,MD5:i});w.S==="1"?(B.success("绑定成功"),D(),M.getUserInfo()):o.errorTxt=w.msg,d.value=!1},F=async()=>{o.errorTxt="";const{yzm:a,newPwd:t,confirmNewPwd:i}=x,{md5:w}=_;let g="";if(/^(?=.*[a-z])(?=.*\d)[A-Za-z\d]{6,16}$/.test(t)?t!==i?g="两次密码不一致":a||(g="请输入验证码"):g="请设置包含字母与数字的6-16位密码",g){o.errorTxt=g;return}d.value=!0;const b=await at({mobile:m.value.Mobile,MD5:w,code:a,newpwd:t});b.S==="1"?(D(),await V({title:"温馨提示",message:"账号密码修改成功，请重新登录",showClose:!1,closeOnClickModal:!1,closeOnPressEscape:!1,distinguishCancelAndClose:!0,confirmButtonText:"重新登录"}),await I()):o.errorTxt=b.msg,d.value=!1},q=async()=>{const{pwd:a}=y;d.value=!0;const t=await nt({PassWord:a});t.S==="1"?(B.success("注销成功"),I()):o.errorTxt=t.msg,d.value=!1},P=async a=>{switch(o.type=a,o.errorTxt="",a){case 1:o.openTitle="修改密码",m.value.Mobile||(await V.confirm("修改密码需要先绑定手机，是否现在去绑定？","提示",{confirmButtonText:"去绑定",cancelButtonText:"取消",type:"warning"}),o.type=2,o.openTitle="绑定手机");break;case 2:o.openTitle="绑定手机";break;case 3:const{QRCode:t}=await ot();if(t){o.qrcode=t,o.openTitle="绑定微信";let w=0;const g=S(()=>{var b;M.getUserInfo(),((b=m.value)!=null&&b.WXUnionID||w>=60)&&(clearInterval(g),D()),w++},1e3)}break;default:const{HelpList:i}=await et({TypeID:8});o.protocolData=i[0].Analysis,o.openTitle="账号注销";break}o.showDialog=!0},O=()=>{V.confirm("您确定退出当前账号吗？","温馨提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{I()})};return X(()=>{$.currentRoute.value.query.showWxDialog==="true"&&showDialog(3),$.currentRoute.value.query.showMobileDialog==="true"&&showDialog(2)}),G(()=>clearInterval(n.timer)),(a,t)=>{const i=Z,w=K,g=Y,b=tt,R=st;return v(),k("div",null,[s("div",rt,[s("div",dt,[s("img",{class:"userface",src:e(m).UserFace,alt:""},null,8,pt),s("div",mt,[s("p",ct,[s("span",null,u(e(m).RealName),1)]),s("p",ut,"ID："+u(e(m).UserID),1)])]),s("div",ft,[s("div",_t,[t[14]||(t[14]=z('<div class="left__box" data-v-082ca181><img src="https://static.ppkao.com/www/images/user/bdphone.png" alt="绑定手机" data-v-082ca181><div class="details__box" data-v-082ca181><p class="title" data-v-082ca181>绑定手机号码</p><p class="memo" data-v-082ca181>为保障您的账户安全，请尽快绑定手机</p></div></div>',1)),e(m).Mobile?(v(),k("p",wt,u(e(m).Mobile.replace(/^(.{3}).*(.{4})$/,"$1****$2")),1)):(v(),U(i,{key:1,type:"primary",class:"bindphone",onClick:t[0]||(t[0]=l=>P(2))},{default:r(()=>t[13]||(t[13]=[p("绑定手机")])),_:1}))]),s("div",gt,[t[16]||(t[16]=z('<div class="left__box" data-v-082ca181><img src="https://static.ppkao.com/www/images/user/editpassword.png" alt="修改密码" data-v-082ca181><div class="details__box" data-v-082ca181><p class="title" data-v-082ca181>修改密码</p><p class="memo" data-v-082ca181>为保障您的账户安全，修改密码需通过手机号验证</p></div></div>',1)),c(i,{type:"primary",plain:"",onClick:t[1]||(t[1]=l=>P(1))},{default:r(()=>t[15]||(t[15]=[p("修改")])),_:1})]),s("div",vt,[t[19]||(t[19]=z('<div class="left__box" data-v-082ca181><img src="https://static.ppkao.com/www/images/user/bdwechat.png" alt="绑定微信" data-v-082ca181><div class="details__box" data-v-082ca181><p class="title" data-v-082ca181>绑定微信</p><p class="memo" data-v-082ca181>绑定后，APP和微信小程序可使用微信快捷登录，多平台使用更方便</p></div></div>',1)),e(m).WXUnionID?(v(),U(i,{key:0,type:"info",disabled:"",plain:""},{default:r(()=>t[17]||(t[17]=[p("已绑定")])),_:1})):(v(),U(i,{key:1,type:"primary",plain:"",onClick:t[2]||(t[2]=l=>P(3))},{default:r(()=>t[18]||(t[18]=[p("绑定")])),_:1}))]),s("div",xt,[s("div",{class:"left__box",style:{"align-items":"start"}},[t[24]||(t[24]=s("img",{src:"https://static.ppkao.com/www/images/user/logoff.png",alt:"注销账号"},null,-1)),s("div",{class:"details__box"},[t[22]||(t[22]=s("p",{class:"title"},"注销账号",-1)),t[23]||(t[23]=s("p",{class:"memo"},[p("注销后您的账号将被删除，不能再使用当前账号登录，也不能再继续使用此账号购买的业务务必"),s("span",{style:{color:"#F42727"}},"谨慎操作！")],-1)),s("p",{class:"memo",style:{"margin-top":"0"}},[t[20]||(t[20]=p("若您仅需退出当前账号，请使用")),s("span",{onClick:O,class:"exit-text"},"退出"),t[21]||(t[21]=p("功能"))])])]),c(i,{type:"primary",plain:"",onClick:t[3]||(t[3]=l=>P(4))},{default:r(()=>t[25]||(t[25]=[p("注销账号")])),_:1})])])]),c(R,{modelValue:e(o).showDialog,"onUpdate:modelValue":t[12]||(t[12]=l=>e(o).showDialog=l),title:e(o).openTitle,width:"450px","destroy-on-close":"",onClosed:D},{default:r(()=>[e(o).type===1?(v(),k("div",yt,[t[31]||(t[31]=s("p",{class:"memo__top"},"请设置6-16位密码，且必须包含字母与数字",-1)),s("div",bt,[t[26]||(t[26]=s("span",{class:"label"},"手机号码",-1)),s("div",kt,[s("span",Tt,u(e(m).Mobile.replace(/^(.{3}).*(.{4})$/,"$1****$2")),1)])]),s("div",ht,[t[27]||(t[27]=s("span",{class:"label"},"验证码",-1)),s("div",Dt,[f(s("input",{type:"tel",autocomplete:"off","onUpdate:modelValue":t[4]||(t[4]=l=>e(x).yzm=l),class:"yzm __input",maxlength:"6"},null,512),[[T,e(x).yzm]]),c(i,{disabled:!e(n).show,class:"code-btn",loading:e(d),type:"primary",plain:"",onClick:E},{default:r(()=>[p(u(e(n).show?"获取验证码":`${e(n).count}秒后获取`),1)]),_:1},8,["disabled","loading"])])]),s("div",Pt,[t[28]||(t[28]=s("span",{class:"label"},"新密码",-1)),s("div",Ct,[f(s("input",{type:"password",autocomplete:"off","onUpdate:modelValue":t[5]||(t[5]=l=>e(x).newPwd=l),class:"__input",maxlength:"16"},null,512),[[T,e(x).newPwd]])])]),s("div",Mt,[t[29]||(t[29]=s("span",{class:"label"},"确认新密码",-1)),s("div",zt,[f(s("input",{type:"password",autocomplete:"off","onUpdate:modelValue":t[6]||(t[6]=l=>e(x).confirmNewPwd=l),class:"__input",maxlength:"16"},null,512),[[T,e(x).confirmNewPwd]])])]),c(i,{loading:e(d),style:{width:"100%",height:"54px",background:"#037AFF"},type:"primary",onClick:F},{default:r(()=>t[30]||(t[30]=[p("确认修改")])),_:1},8,["loading"]),f(s("p",{class:"errotxt"},u(e(o).errorTxt),513),[[C,e(o).errorTxt]])])):e(o).type===2?(v(),k("div",Ut,[t[35]||(t[35]=s("p",{class:"memo__top"},"手机绑定后不可修改，请谨慎操作",-1)),s("div",Vt,[t[32]||(t[32]=s("span",{class:"label"},"手机号码",-1)),s("div",It,[f(s("input",{type:"tel",autocomplete:"off","onUpdate:modelValue":t[7]||(t[7]=l=>e(_).mobilePhone=l),class:"__input",maxlength:"16"},null,512),[[T,e(_).mobilePhone]])])]),s("div",$t,[t[33]||(t[33]=s("span",{class:"label"},"验证码",-1)),s("div",Et,[f(s("input",{type:"tel","onUpdate:modelValue":t[8]||(t[8]=l=>e(_).yzm=l),class:"yzm __input",maxlength:"6"},null,512),[[T,e(_).yzm]]),c(i,{disabled:!e(n).show,style:{width:"117px",height:"54px","margin-left":"7px"},type:"primary",plain:"",onClick:E},{default:r(()=>[p(u(e(n).show?"获取验证码":`${e(n).count}秒后获取`),1)]),_:1},8,["disabled"])])]),c(i,{loading:e(d),style:{width:"100%",height:"54px",background:"#037AFF"},type:"primary",onClick:A},{default:r(()=>t[34]||(t[34]=[p("绑定")])),_:1},8,["loading"]),f(s("p",{class:"errotxt"},u(e(o).errorTxt),513),[[C,e(o).errorTxt]])])):e(o).type===3?(v(),k("div",St,[t[38]||(t[38]=s("p",{class:"memo__top"},"微信绑定后不可修改，请谨慎操作",-1)),s("div",Bt,[c(w,{class:"qr",src:e(o).qrcode,alt:"微信扫一扫"},{error:r(()=>[s("a",{href:"#",onClick:t[9]||(t[9]=(...l)=>a.reload&&a.reload(...l))},"点击重试")]),_:1},8,["src"]),t[36]||(t[36]=s("p",{class:"memo"},"使用微信扫一扫绑定",-1)),t[37]||(t[37]=s("p",{class:"memo"},"绑定成功后请关闭二维码窗口并刷新页面",-1))]),f(s("p",{class:"errotxt"},u(e(o).errorTxt),513),[[C,e(o).errorTxt]])])):(v(),k("div",Nt,[t[41]||(t[41]=s("p",{class:"memo__top"},"仔细阅读注销协议后在协议底部输入密码确认注销",-1)),t[42]||(t[42]=s("p",{class:"xieyi__title"},"考试资料网账号注销协议",-1)),c(g,{"max-height":"345px"},{default:r(()=>[s("div",{class:"xieyi",innerHTML:e(o).protocolData},null,8,At)]),_:1}),c(b,{modelValue:e(y).checked,"onUpdate:modelValue":t[10]||(t[10]=l=>e(y).checked=l),size:"medium"},{default:r(()=>t[39]||(t[39]=[s("p",{class:"check__txt"},"我同意以上协议，并放弃此账号在考试资料网的所有已",-1),s("p",{style:{"margin-top":"10px"},class:"check__txt"},"购服务",-1)])),_:1},8,["modelValue"]),s("div",Ft,[s("div",qt,[f(s("input",{type:"password",autocomplete:"off",placeholder:"输入密码确认注销账号",style:{"font-size":"15px"},"onUpdate:modelValue":t[11]||(t[11]=l=>e(y).pwd=l),class:"__input",maxlength:"16"},null,512),[[T,e(y).pwd]])])]),c(i,{loading:e(d),disabled:e(y).pwd&&!e(y).checked,style:{width:"100%",height:"54px"},type:"danger",onClick:q},{default:r(()=>t[40]||(t[40]=[p("注销账号")])),_:1},8,["loading","disabled"]),f(s("p",{class:"errotxt"},u(e(o).errorTxt),513),[[C,e(o).errorTxt]])]))]),_:1},8,["modelValue","title"])])}}},Kt=L(Ot,[["__scopeId","data-v-082ca181"]]);export{Kt as default};
